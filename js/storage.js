let htmltoparse = `<colgroup><col /><col /><col /><col /></colgroup><tr ><td class="num"><div class="b-container"><div class="bankruptcy" title="03.12.2013 0:00:00"><i class="b-icon"><i></i></i><span>03.12.2013</span></div><a href="https://kad.arbitr.ru/Card/6a05b5d6-5c1e-47b0-9518-beb8b06c3c16" target="_blank" class="num_case">
                            А40-172055/2013
                        </a></div></td><td class="court"><div class="b-container"><div class="judge" title="Истомин С. С.">Истомин С. С.</div><div title="АС города Москвы">АС города Москвы</div></div></td><td class="plaintiff"><div class="b-container"><div class="b-button-container"><div class="b-button"><strong>1854</strong><i class="b-icon"><i></i></i></div></div><div ><span class="js-rollover b-newRollover">
                                    Попова
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Попова</strong><br /></span></span></div><div ><span class="js-rollover b-newRollover">
                                    Бирюков А. И.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Бирюков А. И.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Пономаренко В. П.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Пономаренко В. П.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО КБ Мастер-банк Семеновой Т. С.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО КБ Мастер-банк Семеновой Т. С.</strong><br />
                                        117525, ул. Днепропетровская д. 3 к. 5 кв. 124 Москва
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО КБ Мастер-банк Фальковская Е. В.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО КБ Мастер-банк Фальковская Е. В.</strong><br />
                                        117525, ул. Чертановская д. 24 к. 1 кв. 125 Москва
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ЗАО НПФ &quot;Доломант&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ЗАО НПФ &quot;Доломант&quot;</strong><br />
                                        117437, г. Москва, ул. Профсоюзная, д. 108
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Мельников В. В.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Мельников В. В.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Олейник Л. С.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Олейник Л. С.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ООО &quot;Тандем&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ООО &quot;Тандем&quot;</strong><br />
                                        142432, Моск.обл., г. Черноголовка, Институцский проспект, д. 4, кв. 121
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    СРО НП по содействию и развитию строительной деятельности &quot;Содружество Строителей&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>СРО НП по содействию и развитию строительной деятельности &quot;Содружество Строителей&quot;</strong><br />
                                        197110, Россия, Санткт-Петербург, ул.Малая разночинная,д.9, литА
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Юрина М.А.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Юрина М.А.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Прудников А.Е.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Прудников А.Е.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Борисовая Н.Н.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Борисовая Н.Н.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    НП &quot;Ассоциация проектрировщиков профессионалов&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>НП &quot;Ассоциация проектрировщиков профессионалов&quot;</strong><br />
                                        121309, Россия, Москва, Василисы Кожиной, д.14, корп.6
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Дубровина Е. А.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Дубровина Е. А.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Борисова Н. Н.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Борисова Н. Н.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Иванова Л. В.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Иванова Л. В.</strong><br />
                                        Данные скрыты
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ООО &quot;Центральный булочные&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ООО &quot;Центральный булочные&quot;</strong><br />
                                        198052, Россия, Санкт-Петербург, Измайловский пр., 18
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ООО ФГБУ &quot;Спецмедснаб ФМАБ России&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ООО ФГБУ &quot;Спецмедснаб ФМАБ России&quot;</strong><br />
                                        141400, Россия, г.Химки, МО, Вашутинское ш., д.23
                                    </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО &quot;Промышленный энергетический банк&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО &quot;Промышленный энергетический банк&quot;</strong><br />
                                        160009, Россия, Вологда, Чехова, д. 30
                                    </span></span></div><div class="more"><span class="js-rollover b-newRollover"><a href="https://kad.arbitr.ru/Card/6a05b5d6-5c1e-47b0-9518-beb8b06c3c16" target="_blank" class="num_case">
                                        Подробнее...
                                    </a><span class="js-rolloverHtml" style="display: none;">
                                        Для просмотра полного списка участников перейдите к карточке дела, нажав на эту ссылку
                                    </span></span></div></div></td><td class="respondent"><div class="b-container"><div class="b-button-container"><div class="b-button"><strong>17</strong><i class="b-icon"><i></i></i></div></div><div ><span class="js-rollover b-newRollover">
                                    КБ &quot;Мастер-Банк&quot; (ОАО)&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>КБ &quot;Мастер-Банк&quot; (ОАО)&quot;</strong><br />
                                        109240, МОСКВА, ВЕРХНИЙ ТАГАНСКИЙ ТУПИК, 4
                                                                                                                                                            </span></span></div><div ><span class="js-rollover b-newRollover">
                                    КБ Мастер Банк в лице ГК АСВ
                                    <span class="js-rolloverHtml" style="display: none;"><strong>КБ Мастер Банк в лице ГК АСВ</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Левченко Е. В.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Левченко Е. В.</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    К/У ГК &quot;Агенство по страхованию вкладов&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>К/У ГК &quot;Агенство по страхованию вкладов&quot;</strong><br />
                                        109240, Россия, Москва, Верх.Таганский туп., , д. 4
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО Конкурсный управляющий ОАО &quot;Мастер.Банк&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО Конкурсный управляющий ОАО &quot;Мастер.Банк&quot;</strong><br />
                                        115184, Россия, Москва, пер. Руновский, 12
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    К/у ООО &quot;Мастер-Банк&quot; Бельков А. О.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>К/у ООО &quot;Мастер-Банк&quot; Бельков А. О.</strong><br />
                                        127055, Россия, Москва, ул. Лесная, д. 59, стр. 2
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Конкурсный управляющий ОАО &quot;Мастер.Банк&quot; (ОАО)
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Конкурсный управляющий ОАО &quot;Мастер.Банк&quot; (ОАО)</strong><br />
                                        115184, Россия, Москва, пер. Руновский, 12
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО КБ &quot;Мастер-Банк&quot; в лице к/у ГК &quot;Агентство по страхованию вкладов&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО КБ &quot;Мастер-Банк&quot; в лице к/у ГК &quot;Агентство по страхованию вкладов&quot;</strong><br />
                                        127055, Россия, Москва, ул. Лесная, д. 59, стр. 2
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ГК КБ &quot;Мастер-Банк&quot; в лице &quot;Агентство по страхованию вкладов&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ГК КБ &quot;Мастер-Банк&quot; в лице &quot;Агентство по страхованию вкладов&quot;</strong><br />
                                        109240, Россия, Москва, Верхн. Таганский туп., 4
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ГК К/У &quot;Агенство по страхованию вкладов&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ГК К/У &quot;Агенство по страхованию вкладов&quot;</strong><br />
                                        109240, Россия, Москва, Верх.Таганский туп., , д. 4
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ОАО КУ КБ &quot;Мастер-Банк&quot;
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ОАО КУ КБ &quot;Мастер-Банк&quot;</strong><br />
                                        115184, Россия, Москва, Руновский пер., 12
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    ООО К/у &quot;Мастер-Банк&quot; Бельков А.О.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>ООО К/у &quot;Мастер-Банк&quot; Бельков А.О.</strong><br />
                                        127055, Россия, Москва, ул. Лесная, д. 59, стр. 2
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Левченко Е.В.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Левченко Е.В.</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Булочник А.Б.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Булочник А.Б.</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Киселев А.Г.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Киселев А.Г.</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    Орлов В.А.
                                    <span class="js-rolloverHtml" style="display: none;"><strong>Орлов В.А.</strong><br />
                                        Данные скрыты
                                                                                                                                                            </span></span></div><div class='more'><span class="js-rollover b-newRollover">
                                    НОПРИЗ
                                    <span class="js-rolloverHtml" style="display: none;"><strong>НОПРИЗ</strong><br />
                                        119019, Россия, Москва, Н.Арбат, 21
                                                                                                                                                            </span></span></div></div></td></tr><input type="hidden" id="documentsPageSize" value="25" /><input type="hidden" id="documentsPage" value="1" /><input type="hidden" id="documentsTotalCount" value="1" /><input type="hidden" id="documentsPagesCount" value="1" />`;


let xml = HTMLtoXML(htmltoparse);
let dom = HTMLtoDOM('<div>'+xml+'</div>');
console.log('dom: ',dom);
let trs = dom.querySelectorAll('div > tr');
for (let i = 0; i < trs.length; i++) {
  let tr = trs[i];
  // console.log('tr: ',tr);
  let courtcase = new Object();
  let tr_num = tr.querySelector('td.num');
  courtcase.num = tr_num.querySelector('.num_case').innerHTML.trim();
  //console.log('case_num: ',courtcase.num);
  courtcase.type = tr.querySelector('td.num > div.b-container > div').getAttribute('class').trim();
  //console.log('case_type: ',courtcase.type);
  let case_time = tr.querySelector('td.num > div.b-container > div').getAttribute('title').trim().split(' ')[0].split('.');
  courtcase.time = new Date(case_time[2], case_time[1] - 1, case_time[0]);
  //console.log('case_time: ', courtcase.time);
  let tr_court = tr.querySelector('td.court');
  courtcase.court = tr_court.querySelector('div:not([class])').innerHTML.trim();
  //console.log('court: ',courtcase.court);
  courtcase.judge = tr_court.querySelector('div.judge').innerHTML.trim();
  //console.log('judge: ',courtcase.judge);
  //document.querySelector("li:not([class])")
  //console.log('court: ',tr_court);
  courtcase.plaintiffs = new Array();

  let td_plaintiff = tr.querySelector('td.plaintiff');
  //console.log('td_plaintiff: ',td_plaintiff);
  let plaintiffs_rollovers = td_plaintiff.querySelectorAll('span.js-rollover');
  for (let i = 0; i < plaintiffs_rollovers.length; i++) {
    let plaintiff = new Object();
    let rollover = plaintiffs_rollovers[i];
    //console.log('rollover: ', rollover);
    let name = rollover.querySelector('strong');
    let rolloverHtml = rollover.querySelector('.js-rolloverHtml');
    //console.log('rolloverHtml: ', rolloverHtml);
    
    if (rolloverHtml.childNodes.length > 1) {
      for (let i = 0; i < rolloverHtml.childNodes.length; i++) {
        let childNode = rolloverHtml.childNodes[i];
        if (childNode.nodeType === 3) {
          let address = childNode.nodeValue.trim().replaceAll('&amp;quot;','"');
          //console.log('address: ', address);
          plaintiff.address=address;
        }
        
      }
    }
    //let plaintiff_address = rolloverHtml.innerHTML.trim().replaceAll('&amp;quot;','"');
    //console.log('plaintiff_address: ',plaintiff_address);
    if (name !== null) {
      let str = name.innerHTML.trim().replaceAll('&amp;quot;','"');
      //console.log('name: ', str);
      plaintiff.name = str;
    }
    //console.log('plaintiff: ',plaintiff);
    if (plaintiff.name !== undefined) {
      courtcase.plaintiffs.push(plaintiff);
    }
   
  }

  //console.log('plaintiffs: ', courtcase.plaintiffs);
  courtcase.respondents = new Array();
  let td_respondent = tr.querySelector('td.respondent');
  //console.log('respondent: ',td_respondent);
  let respondents_rollovers = td_respondent.querySelectorAll('span.js-rollover');
  for (let i = 0; i < respondents_rollovers.length; i++) {
    let respondent = new Object();
    let rollover = respondents_rollovers[i];
    //console.log('rollover: ', rollover);
    respondent.name = rollover.querySelector('strong').innerHTML.trim().replaceAll('&amp;quot;','"');
    //console.log('name: ', respondent.name);
    let rolloverHtml = rollover.querySelector('.js-rolloverHtml');
    //console.log('rolloverHtml: ', rolloverHtml);
    if (rolloverHtml.childNodes.length > 1) {
      for (let i = 0; i < rolloverHtml.childNodes.length; i++) {
        let childNode = rolloverHtml.childNodes[i];
        if (childNode.nodeType === 3) {
          let address = childNode.nodeValue.trim().replaceAll('&amp;quot;','"');
          //console.log('address: ', address);
          respondent.address=address;
        }
        
      }
    }
    //console.log('respondent: ', respondent);
    courtcase.respondents.push(respondent);
  }

  console.log('courtcase: ', courtcase);
}
let elt_num = dom.querySelector('.num');
let elt_num_case = dom.querySelector('.num_case');
console.log('elt_num: ',elt_num);
console.log('elt_num_case: ',elt_num_case.innerHTML.trim());

let xmlString = '<xml>'+xml+'</xml>';  	// get some xml (string or document/node)

let result = xmlToJSON.parseString(xmlString, {
	mergeCDATA: false,
	xmlns: false,
	attrsAsObject: false
});	// parse

//console.log('result: ',JSON.stringify(result));

/*
{
  "xml":[
    {
      "colgroup":[
        {
          "col":[
            {"_text":[null]},
            {"_text":[null]},
            {"_text":[null]},
            {"_text":[null]}
          ]
        }
      ],
      "tr":[
        {"td":[
          {
            "_attrclass":{"_value":"num"},
            "div":[
              {
                "_attrclass":{"_value":"b-container"},
                "div":[
                  {
                    "_attrclass":{"_value":"bankruptcy"},
                    "_attrtitle":{"_value":"03.12.2013 0:00:00"},
                    "i":[
                      {
                        "_attrclass":{"_value":"b-icon"},
                        "i":[
                          {"_text":[null]}
                        ]
                      }
                    ],
                    "span":[{"_text":"03.12.2013"}]
                  }
                ],
                "a":[
                  {
                    "_attrhref":{"_value":"https://kad.arbitr.ru/Card/6a05b5d6-5c1e-47b0-9518-beb8b06c3c16"},
                    "_attrtarget":{"_value":"_blank"},
                    "_attrclass":{"_value":"num_case"},
                    "_text":"А40-172055/2013"}
                  ]
                }
              ]
            },{"_attrclass":{"_value":"court"},"div":[{"_attrclass":{"_value":"b-container"},"div":[{"_attrclass":{"_value":"judge"},"_attrtitle":{"_value":"Истомин С. С."},"_text":"Истомин С. С."},{"_attrtitle":{"_value":"АС города Москвы"},"_text":"АС города Москвы"}]}]},{"_attrclass":{"_value":"plaintiff"},"div":[{"_attrclass":{"_value":"b-container"},"div":[{"_attrclass":{"_value":"b-button-container"},"div":[{"_attrclass":{"_value":"b-button"},"strong":[{"_text":1854}],"i":[{"_attrclass":{"_value":"b-icon"},"i":[{"_text":[null]}]}]}]},{"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Попова"}],"br":[{"_text":[null]}]}],"_text":"Попова"}]},{"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Бирюков А. И."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Бирюков А. И."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Пономаренко В. П."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Пономаренко В. П."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО КБ Мастер-банк Семеновой Т. С."}],"br":[{"_text":[null]}],"_text":"117525, ул. Днепропетровская д. 3 к. 5 кв. 124 Москва"}],"_text":"ОАО КБ Мастер-банк Семеновой Т. С."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО КБ Мастер-банк Фальковская Е. В."}],"br":[{"_text":[null]}],"_text":"117525, ул. Чертановская д. 24 к. 1 кв. 125 Москва"}],"_text":"ОАО КБ Мастер-банк Фальковская Е. В."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ЗАО НПФ \"Доломант\""}],"br":[{"_text":[null]}],"_text":"117437, г. Москва, ул. Профсоюзная, д. 108"}],"_text":"ЗАО НПФ \"Доломант\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Мельников В. В."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Мельников В. В."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Олейник Л. С."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Олейник Л. С."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ООО \"Тандем\""}],"br":[{"_text":[null]}],"_text":"142432, Моск.обл., г. Черноголовка, Институцский проспект, д. 4, кв. 121"}],"_text":"ООО \"Тандем\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"СРО НП по содействию и развитию строительной деятельности \"Содружество Строителей\""}],"br":[{"_text":[null]}],"_text":"197110, Россия, Санткт-Петербург, ул.Малая разночинная,д.9, литА"}],"_text":"СРО НП по содействию и развитию строительной деятельности \"Содружество Строителей\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Юрина М.А."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Юрина М.А."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Прудников А.Е."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Прудников А.Е."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Борисовая Н.Н."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Борисовая Н.Н."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"НП \"Ассоциация проектрировщиков профессионалов\""}],"br":[{"_text":[null]}],"_text":"121309, Россия, Москва, Василисы Кожиной, д.14, корп.6"}],"_text":"НП \"Ассоциация проектрировщиков профессионалов\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Дубровина Е. А."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Дубровина Е. А."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Борисова Н. Н."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Борисова Н. Н."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Иванова Л. В."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Иванова Л. В."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ООО \"Центральный булочные\""}],"br":[{"_text":[null]}],"_text":"198052, Россия, Санкт-Петербург, Измайловский пр., 18"}],"_text":"ООО \"Центральный булочные\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ООО ФГБУ \"Спецмедснаб ФМАБ России\""}],"br":[{"_text":[null]}],"_text":"141400, Россия, г.Химки, МО, Вашутинское ш., д.23"}],"_text":"ООО ФГБУ \"Спецмедснаб ФМАБ России\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО \"Промышленный энергетический банк\""}],"br":[{"_text":[null]}],"_text":"160009, Россия, Вологда, Чехова, д. 30"}],"_text":"ОАО \"Промышленный энергетический банк\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"a":[{"_attrhref":{"_value":"https://kad.arbitr.ru/Card/6a05b5d6-5c1e-47b0-9518-beb8b06c3c16"},"_attrtarget":{"_value":"_blank"},"_attrclass":{"_value":"num_case"},"_text":"Подробнее..."}],"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"_text":"Для просмотра полного списка участников перейдите к карточке дела, нажав на эту ссылку"}]}]}]}]},{"_attrclass":{"_value":"respondent"},"div":[{"_attrclass":{"_value":"b-container"},"div":[{"_attrclass":{"_value":"b-button-container"},"div":[{"_attrclass":{"_value":"b-button"},"strong":[{"_text":17}],"i":[{"_attrclass":{"_value":"b-icon"},"i":[{"_text":[null]}]}]}]},{"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"КБ \"Мастер-Банк\" (ОАО)\""}],"br":[{"_text":[null]}],"_text":"109240, МОСКВА, ВЕРХНИЙ ТАГАНСКИЙ ТУПИК, 4"}],"_text":"КБ \"Мастер-Банк\" (ОАО)\""}]},{"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"КБ Мастер Банк в лице ГК АСВ"}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"КБ Мастер Банк в лице ГК АСВ"}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Левченко Е. В."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Левченко Е. В."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"К/У ГК \"Агенство по страхованию вкладов\""}],"br":[{"_text":[null]}],"_text":"109240, Россия, Москва, Верх.Таганский туп., , д. 4"}],"_text":"К/У ГК \"Агенство по страхованию вкладов\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО Конкурсный управляющий ОАО \"Мастер.Банк\""}],"br":[{"_text":[null]}],"_text":"115184, Россия, Москва, пер. Руновский, 12"}],"_text":"ОАО Конкурсный управляющий ОАО \"Мастер.Банк\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"К/у ООО \"Мастер-Банк\" Бельков А. О."}],"br":[{"_text":[null]}],"_text":"127055, Россия, Москва, ул. Лесная, д. 59, стр. 2"}],"_text":"К/у ООО \"Мастер-Банк\" Бельков А. О."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Конкурсный управляющий ОАО \"Мастер.Банк\" (ОАО)"}],"br":[{"_text":[null]}],"_text":"115184, Россия, Москва, пер. Руновский, 12"}],"_text":"Конкурсный управляющий ОАО \"Мастер.Банк\" (ОАО)"}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО КБ \"Мастер-Банк\" в лице к/у ГК \"Агентство по страхованию вкладов\""}],"br":[{"_text":[null]}],"_text":"127055, Россия, Москва, ул. Лесная, д. 59, стр. 2"}],"_text":"ОАО КБ \"Мастер-Банк\" в лице к/у ГК \"Агентство по страхованию вкладов\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ГК КБ \"Мастер-Банк\" в лице \"Агентство по страхованию вкладов\""}],"br":[{"_text":[null]}],"_text":"109240, Россия, Москва, Верхн. Таганский туп., 4"}],"_text":"ГК КБ \"Мастер-Банк\" в лице \"Агентство по страхованию вкладов\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ГК К/У \"Агенство по страхованию вкладов\""}],"br":[{"_text":[null]}],"_text":"109240, Россия, Москва, Верх.Таганский туп., , д. 4"}],"_text":"ГК К/У \"Агенство по страхованию вкладов\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ОАО КУ КБ \"Мастер-Банк\""}],"br":[{"_text":[null]}],"_text":"115184, Россия, Москва, Руновский пер., 12"}],"_text":"ОАО КУ КБ \"Мастер-Банк\""}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"ООО К/у \"Мастер-Банк\" Бельков А.О."}],"br":[{"_text":[null]}],"_text":"127055, Россия, Москва, ул. Лесная, д. 59, стр. 2"}],"_text":"ООО К/у \"Мастер-Банк\" Бельков А.О."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Левченко Е.В."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Левченко Е.В."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Булочник А.Б."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Булочник А.Б."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Киселев А.Г."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Киселев А.Г."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"Орлов В.А."}],"br":[{"_text":[null]}],"_text":"Данные скрыты"}],"_text":"Орлов В.А."}]},{"_attrclass":{"_value":"more"},"span":[{"_attrclass":{"_value":"js-rollover b-newRollover"},"span":[{"_attrclass":{"_value":"js-rolloverHtml"},"_attrstyle":{"_value":"display: none;"},"strong":[{"_text":"НОПРИЗ"}],"br":[{"_text":[null]}],"_text":"119019, Россия, Москва, Н.Арбат, 21"}],"_text":"НОПРИЗ"}]}]}]}]}],"input":[{"_attrtype":{"_value":"hidden"},"_attrid":{"_value":"documentsPageSize"},"_attrvalue":{"_value":25},"_text":[null]},{"_attrtype":{"_value":"hidden"},"_attrid":{"_value":"documentsPage"},"_attrvalue":{"_value":1},"_text":[null]},{"_attrtype":{"_value":"hidden"},"_attrid":{"_value":"documentsTotalCount"},"_attrvalue":{"_value":1},"_text":[null]},{"_attrtype":{"_value":"hidden"},"_attrid":{"_value":"documentsPagesCount"},"_attrvalue":{"_value":1},"_text":[null]}]}]}
*/

/**
 * Проверка запуска окна в iframe
 * @returns boolean
 */
function iniFrame() {
  let location = false;
  if (window.location !== window.parent.location) {
    location = true;
  } 

  let self = false;
  if (window.self !== window.top) {
    self = true;
  }
  
  console.log('location: ', location);
  console.log('self: ', self);

  return location && self;
}

/**
 * Проверка IndexedDB
 */ 
window.indexedDB =
  window.indexedDB ||
  window.mozIndexedDB ||
  window.webkitIndexedDB ||
  window.msIndexedDB;
window.IDBTransaction =
  window.IDBTransaction ||
  window.webkitIDBTransaction ||
  window.msIDBTransaction;
window.IDBKeyRange =
  window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

if (!window.indexedDB) {
  console.log(
    "Этот браузер не поддерживает стабильную версию IndexedDB. Сохранение базы данных невозможно",
  );
}

/**
 * -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 * =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 * -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 */

/**
 * Прослушиватель для сообщений
 */
window.addEventListener('message', function(msg) {
  if (msg.origin === 'https://kad.arbitr.ru') {
    let obj = undefined;
    
    try {
      obj = JSON.parse(msg.data);
    } catch (err) {
      obj = msg.data;
    }

    if (obj.key === 'storage') {
      //console.log('msg:',msg);
      //console.log('obj:',obj);
      let info = obj.info !== undefined ? obj.info : '';
      let dates = obj.dates !== undefined ? obj.dates : '';

      try {
        dates = JSON.parse(dates);
      } catch (err) {
      }

      try {
        info = JSON.parse(info);
        info.Id = (new Date()).getTime(); // Timestamp
        info.DateFrom = new Date(dates[0][2]+ '.' + dates[0][1] + '.' + dates[0][0]);
        info.DateTo = new Date(dates[1][2]+ '.' + dates[1][1] + '.' + dates[1][0]);
      } catch (err) {
      }


      //Сообщение отправленно в storage.html
      if (typeof(info) === 'object') {
        console.log('%cв storage.html поступил объект: %o','color:#FB74BD;', info);
        console.log('%c' + 'Id: %o','color:#FB74BD;', info.Id);
        console.log('%c' + 'Page: %o','color:#FB74BD;', info.Page);
        console.log('%c' + 'Count: %o','color:#FB74BD;', info.Count);
        console.log('%c' + 'Courts: %o','color:#FB74BD;',info.Courts);
        for (let i = 0; i < info.Courts.length; i++) {
          console.log('%c' + 'Court: %o','color:#FB74BD;',info.Courts[i]);
        }
        console.log('%c' + 'DateFrom: %o','color:#FB74BD;',info.DateFrom);
        console.log('%c' + 'DateTo: %o','color:#FB74BD;',info.DateTo);
        console.log('%c' + 'Sides: %o','color:#FB74BD;',info.Sides);
        console.log('%c' + 'Judges: %o','color:#FB74BD;',info.Judges);
        console.log('%c' + 'CaseNumbers: %o','color:#FB74BD;',info.CaseNumbers);
        console.log('%c' + 'WithVKSInstances: %o','color:#FB74BD;',info.WithVKSInstances);
      } else {
        console.log('%cв storage.html поступило сообщение: ','color:#FB74BD;', info);
      }

      if (typeof(dates) === 'object') {
        console.log('%cв storage.html поступил объект: %o','color:#FB74BD;', dates);
      } else {
        console.log('%cв storage.html поступило сообщение: ','color:#FB74BD;', dates);
      }
      
      // читать здесь
      // https://ru.stackoverflow.com/questions/1275278/%D0%9A%D0%B0%D0%BA-%D0%BE%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-iframe-%D0%B8-%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D0%BE
    }
    
  } else if (msg.origin === 'https://casebookkiller.github.io') {
    console.log(msg);
  }
},false);

/**
 * Настройка загрузки wasm
 */
let config = {
  locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.11.0/${filename}`
}

if (document.cbk === undefined) {
  document.cbk = new Object();
  let cbk = document.cbk;
  cbk.storage = 'isloaded';
}

// Создание тестовой таблицы
function createTestDB(SQLitedb) {
  // Запрос на создание таблицы
  SQLitedb.run("CREATE TABLE test (col1, col2);");
  // Запрос на создание двух записей: (1,111) и (2,222)
  SQLitedb.run("INSERT INTO test VALUES (?,?), (?,?)", [1,111,2,222]);
}

// Запрос к тестовой таблице
function requestTestDB(SQLitedb) {
  // Подготовка запроса
  const stmt = SQLitedb.prepare("SELECT * FROM test WHERE col1 BETWEEN $start AND $end");
  stmt.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}

  // Привязка новых значений
  stmt.bind({$start:1, $end:2});
  while(stmt.step()) { //
    const row = stmt.getAsObject();
    console.log('Here is a row: ' + JSON.stringify(row));
  }
}

// Создание таблицы c историей запросов
function createHistoryDB(SQLitedb) {
  // Запрос на создание таблицы
  // CREATE TABLE IF NOT EXISTS TblUsers (UserId INTEGER PRIMARY KEY, UserName varchar(100), ContactName varchar(100),Password varchar(100));
  SQLitedb.run("CREATE TABLE IF NOT EXISTS history (id PRIMARY KEY, Page, Count, Courts, DateFrom, DateTo, Sides, Judges, CaseNumbers, WithVKSInstances);");
  /*
    {
      "Page": 1,
      "Count": 25,
      "Courts": [],
      "DateFrom": null,
      "DateTo": null,
      "Sides": [],
      "Judges": [],
      "CaseNumbers": [
        "А40-172055/2013"
      ],
    "WithVKSInstances": false
  }
  */
  // Запрос на создание двух записей: (1,111) и (2,222)
  //SQLitedb.run("INSERT INTO test VALUES (?,?), (?,?)", [1,111,2,222]);
}

// Функция `initsqls` глобально предоставляется всеми основными дистрибутивами, если они загружены в браузер.
// Мы должны указать эту функцию locateFile, если мы загружаем wasm-файл из любого другого места, кроме папки текущей html-страницы.
let iDB, SQLitedb, binarydb;
initSqlJs(config).then(function(SQL) {
  // Создание базы данных
  SQLitedb = new SQL.Database();

  // Создание тестовой таблицы
  createTestDB(SQLitedb);
  // Запрос к тестовой таблице
  requestTestDB(SQLitedb);
  
  binarydb = SQLitedb.export();
  getCasesDb(cbGetBinary);

  console.log('проверка binarydb:', binarydb);
  if (binarydb === undefined) saveCasesDb(binarydb, cbSaveCasesDB);
  
  if (iniFrame()) {
    // Если окно запущено в iframe
    let origin;

    try { origin = top?.origin } catch (err) { origin = null }

    console.log('origin: ', origin);
    
    if (origin !== null) {
      console.log('top.origin: ', origin);
      if (origin === 'https://kad.arbitr.ru') top.postMessage("сообщение из iframe", 'https://kad.arbitr.ru');
    } else {
      console.log('Окно открыто с тем же origin');
    }
  }
});

/**
 *  IndexedDB
 */ 

// Обратный вызов при сохранении базы данных
function cbSaveCasesDB(db) {
  console.log('casesdb: ', db);
}

// Обратный вызов при получении базы данных
function cbGetCasesDB(db) {
  console.log('casesdb: ', db);
}

// Обратный вызов при получении базы данных
function cbGetBinary(result) {
  console.log(result)
  if (result.length !== 0) {
    console.log('binary: ', result.find(i => i.cbk === 1).database);
  } else {
    console.log('база не получена');
  }
}

// Запрос на открытие базы данных
function openRequestDB(name, version) {
  return window.indexedDB.open(name, version);
}

// Обновление структуры базы данных
function iDBUpgradeNeeded(event) {
  console.log('request: ', event.target);
  console.log('event: ', event);
  console.log('event: ', event);
  // версия существующей базы данных меньше 2 (или база данных не существует)
  iDB = event.target.result; //openRequest.result;
  console.log('event: ', event);      
  switch(event.oldVersion) { // существующая (старая) версия базы данных
    case 0:
      // версия 0 означает, что на клиенте нет базы данных
      // выполнить инициализацию
      if (!iDB.objectStoreNames.contains('cases')) { // если хранилище "cases" не существует
        iDB.createObjectStore('cases', {keyPath: 'cbk'}); // создаём хранилище
      }
    case 1:
      // на клиенте версия базы данных 1
      // обновить
  }
  console.log(iDB.objectStoreNames);
}

// Обработка блокировки базы данных
function iDBBlocked (event) {
  // это событие не должно срабатывать, если мы правильно обрабатываем onversionchange
  // это означает, что есть ещё одно открытое соединение с той же базой данных
  // и он не был закрыт после того, как для него сработал db.onversionchange
  console.log('Сработало событие блокировки. Необходимо закрыть другие вкладки.');
}

// Обработка ошибок
function iDBError (event) {
  console.log('event: ', event);
  console.error("Ошибка загрузки базы данных", openRequest.error);
}

// Обработка открытия базы данных
function iDBOpened (event, func, cb) {
  iDB = event.target.result;
  console.log('iDB: ', iDB);
  iDB.onversionchange = function() {
    iDB.close();
    alert('База данных устарела, пожалуйста, перезагрузите страницу.');
  };
  // ...база данных готова...
  func(iDB, cb);
}

function getAll(iDB, cb) {
  console.log('function getAll');
  const transaction = iDB.transaction("cases", "readwrite"); // (1)
  // получить хранилище объектов для работы с ним
  const cases = transaction.objectStore("cases"); // (2)
  const getAll = cases.getAll();
  getAll.onsuccess = function(e) {
    cb(getAll.result);
  }
  getAll.onerror = function(e) {
    console.log(e);
  }      
}

function DBRequest(
  iDB,                  // IndexedDB
  storeName,            // Имя хранилища
  requestType,          // Тип запроса
  requestParams,        // Параметры запроса
  cb                    // Функция обратного вызова в случае успеха
) {
  const transaction = iDB.transaction(storeName, 'readwrite');
  const store = transaction.objectStore(storeName); // получить хранилище объектов
  const request = store[requestType](requestParams);
  request.onsuccess = (e) => {
    console.log('Запрос "'+requestType+'" выполнен.');
    console.log('Результат запроса: ', e.target.result);
    cb(e.target.result);
  }
}

// здесь должно быть открытие
function getCasesDb(cb) {
  // Открытие IndexedDB
  const openRequest = openRequestDB('casebook{killer}',1);//window.indexedDB.open("casebook{killer}", 1);
  openRequest.onupgradeneeded = (e) => iDBUpgradeNeeded(e); // Обновление структуры базы данных
  openRequest.onblocked = (e) => iDBBlocked(e); // Обработка блокировки
  openRequest.onerror = (e) => iDBError(e); // Обработка ошибок
  openRequest.onsuccess = (e) => {
    iDBOpened(
      e, 
      ()=> DBRequest(iDB,'cases','getAll',undefined,cb), 
      cb
    ); // При успешном открытии
  }
}

// сюда перенести алгоритм сохраения бд
function saveCasesDb(binary, cb) {
  console.log('saveCasesDB: ', binary);
  // Открытие IndexedDB
  const openRequest = openRequestDB('casebook{killer}',1);
  openRequest.onupgradeneeded = (e) => iDBUpgradeNeeded(e); // Обновление структуры базы данных
  openRequest.onblocked = (e) => iDBBlocked(e); // Обработка блокировки
  openRequest.onerror = (e) => iDBError(e); // Обработка ошибок
  openRequest.onsuccess = (e) => {
    console.log('event: ', e);
    iDB = e.target.result;
    iDB.onversionchange = function() {
      iDB.close();
      alert("База данных устарела, пожалуйста, перезагрузите страницу.")
    };
    // ...база данных готова...
    DBRequest(
      iDB, 
      'cases',
      'put',
      {
        cbk: 1, 
        database: binary},
      cb
    );
  };
}
